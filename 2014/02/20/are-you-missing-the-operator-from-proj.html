<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>RapidPM - Blog</title>

    <!-- Bootstrap-CSS -->
    <link href="http://rapidpm.github.io/site/css/bootstrap.min.css" rel="stylesheet">

    <!-- Besondere Stile für diese Vorlage -->
    <link href="http://rapidpm.github.io/site/css/blog.css" rel="stylesheet">

    <!-- Nur für Testzwecke. Kopiere diese Zeile nicht in echte Projekte! -->
    <!--[if lt IE 9]>
    <script src="http://rapidpm.github.io/site/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- Unterstützung für Media Queries und HTML5-Elemente im Internet Explorer über HTML5 shim und Respond.js -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!-- Include required JS files -->
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shCore.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJava.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushSql.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJScript.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushXml.js"></script>

    <!-- Include *at least* the core style and default theme -->
    <link href="http://rapidpm.github.io/site/syntax/shCore.css" rel="stylesheet" type="text/css" />
    <link href="http://rapidpm.github.io/site/syntax/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <!-- Custom styles for this template -->
    <link href="http://rapidpm.github.io/site/css/carousel.css" rel="stylesheet">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-35462441-1', 'auto');
    ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->
</head>

<body>

<!-- NAVBAR
================================================== -->
<div class="navbar-wrapper">
    <div class="container">

        <div class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://www.rapidpm.org">RapidPM</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/conferences/index.html">Conferences/Talks</a></li>
                        <li><a href="/publications/index.html">Publications</a></li>
                        <li><a href="/license/index.html">License</a></li>
                        <li><a href="/releases/index.html">Releases</a></li>
                        <li><a href="/contact/index.html">Contact</a></li>
                        <li><a href="/impressum/index.html">Impressum</a></li>
                        <!--
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Team<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Sven Ruppert</a></li>
                                <li><a href="#">Marco Ebbinghaus</a></li>
                                <li><a href="#">Alexander Bischof</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                        -->
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>


<!-- Carousel
================================================== -->
<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
        <!--<li data-target="#myCarousel" data-slide-to="4"></li>
        <li data-target="#myCarousel" data-slide-to="5"></li>
        -->
    </ol>
    <div class="carousel-inner">
        <div class="item active">
            <!--<img data-src="holder.js/900x500/auto/#777:#7a7a7a/">-->
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>New Version 2.0.1</h1>
                    <p>the new version is available at maven central </br>
                    we added a new module for iot with tinkerforge.</p>
                    <p><a class="btn btn-lg btn-primary" href="http://search.maven.org/#search%7Cga%7C1%7Crapidpm"
                    role="button">jump to maven central</a></p>
                    <p><br/><br/><br/><br/></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
            <div class="container">
                <div class="carousel-caption">
                    <img src="/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
                </div>
            </div>
        </div>
        <div class="item">
                    <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
                    <div class="container">
                        <div class="carousel-caption">
                            <img src="/team/alex-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
                        </div>
                    </div>
                </div>
        <div class="item">
            <img data-src="holder.js/auto/#666:#6a6a6a/text:" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>our git repository</h1>
                    <p>RapidPM could be found under <br/>
                    <code><a xlink:href="https://bitbucket.org/rapidpm/modules" target="_blank">bitbucket.org/rapidpm/modules</a></code>
                    </p>
                    <p><br/><br/><br/><br/></p>
                </div>
            </div>
        </div>
                <!--

        <div class="item">
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/text:Second slide" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>Another example headline.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img data-src="holder.js/900x500/auto/#555:#5a5a5a/text:Third slide" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>One more for good measure.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
                </div>
            </div>
        </div>
        -->
    </div>
    <!--<a class="left carousel-control" href="#myCarousel" data-slide="prev"><span class="glyphicon glyphicon-chevron-left"></span></a>-->
    <!--<a class="right carousel-control" href="#myCarousel" data-slide="next"><span class="glyphicon glyphicon-chevron-right"></span></a>-->
</div><!-- /.carousel -->





<div class="container">

    <div class="blog-header">
        <h1 class="blog-title">The RapidPM Blog</h1>
        <p class="lead blog-description">We are speaking Java, because it is a great pleasure for us.</p>
    </div>

    <div class="row">

        <div class="col-sm-8 blog-main">
<div class="blog-post">
<h2 class="blog-post-title"><a href=/2014/02/20/are-you-missing-the-operator-from-proj.html>are you missing the ? operator from project coin?</a></h2>
<p class="blog-post-meta">2014-02-20 from <a href="/team/sven-ruppert/">Sven Ruppert</a></p>
How to get rid of 90% boiler plate code from NPE-save model - surfing?
<br/>
What I am meaning with modell surfing?
For example you have a class DemoClassA.<br/>
Inside DemoClassA you have an instance of DemoClassB.<br/>
Inside DemoClassB you have an instance of DemoClassC. And so on..<br/>
<br/>
You need something like the following.<br/>
<br/>
<pre class="brush: java">
String value = demoClassA.getDemoClassB().getDemoClassC().getValue();
    </class></pre>
The bad thing is if your valid model could have ClassB or ClassC with null.
You only have to show the value inside your GUI if the complete getter - cascade will be valid.
The first would be something like this.<br/>
<br/>
<pre class="brush: java">  
 DemoClassB valueB = demoClassA.getDemoClassB();
 if(demoB != null){
    DemoClassC demoC = demoB.getDemoClassC();
    if(demoC != null){
     String value = demoC.getValue();
    }
 }
    </class></pre>
A lot of booooring code. Project Coin had something with Wildcards.
<br/>
<pre class="brush: java"> 
 String value = demoClassA?.getDemoClassB()?.getDemoClassC()?.getValue();
    </class></pre>
This is really nice, but it was not accepted. So I had do something like this for myself.
<br/>
One main point will be that the objects are ready initialized and I could not change the source code from this part.
Other languages as plain Java are not allowed.
No other frameworks, no AOP and something like this.
Puuhh.. what else?
<br/>
I was thinking about the newsletter nr 180 (<a href="http://www.javaspecialists.eu/archive/Issue180.html">http://www.javaspecialists.eu/archive/Issue180.html</a>) from Heinz Kabutz.
He explained how to generate static Proxy Classes. This was a good point to start from.
<br/>
The key concept is the generating of Proxy Classes on the fly if they are needed. Via Reflection the real Subject is analysed and the Proxy generated. He is instanciating the new proxy class and the real subject with the default constructor. For my project this was not helpfull, because the model was grown over the last 10 years. Nearly no default constructor is available and the project owner was building something like a RMI Lazy Loading inside the persistent model. This model itself is used directly inside Swing.. hmmmmm  nothing was I really want to use... <br/>
Changing the old code is very time consuming. <br/>
On the other side I was writing a lot of this if != null code. <br/>
So I decided to write a Proxy that I can use on initialized objects. This must be recursive to get the NPE save getter cascades.
Based on Heinz code, I started to write a <b>VirtualProxySourceGeneratorOnExistingObject </b>to stop the instance creation on the real Subject.
<br/>
<pre class="brush: java">
public class VirtualProxySourceGeneratorOnExistingObject extends VirtualProxySourceGenerator {

    public VirtualProxySourceGeneratorOnExistingObject(
            Class subject, Class realSubject) {
        super(subject, realSubject, Concurrency.OnExistingObject);
    }
    protected void addRealSubjectCreation(PrintWriter out,  String name, String realName) {
        out.printf(" public %s realSubject;%n", name);
        out.println();
        out.printf(" private %s realSubject() {%n", name);
        out.println(" return realSubject;");
        out.println(" }");
    }
}
    </class></pre>
After this I changed the <b>VirtualProxySourceGenerator</b>to use this <b>VirtualProxySourceGeneratorOnExistingObject</b> and changed it in a way that a getter method will generate a new Proxy for the next realSubject.
<br/>
<pre class="brush: java">
public abstract class VirtualProxySourceGenerator {

    protected final Class subject;
    protected final Class realSubject;
    private final String proxy;
    private CharSequence charSequence;
    private Concurrency type;

    public VirtualProxySourceGenerator(
            Class subject, Class realSubject, Concurrency type) {
        this.subject = subject;
        this.realSubject = realSubject;
        this.type = type;
        this.proxy = makeProxyName(subject, type);

    }

    private static String makeProxyName(Class subject, Concurrency type) {
        return "$$_" + subject.getName().replace('.', '_') +
                "Proxy_" + Integer.toHexString(System.identityHashCode(
                subject.getClassLoader())) + "_" + type;
    }

    public String getProxyName() {
        return proxy;
    }

    public CharSequence getCharSequence() {
        if (charSequence == null) {
            StringWriter sw = new StringWriter();
            generateProxyClass(new PrintWriter(sw));
            charSequence = sw.getBuffer();
        }
        //System.out.println("charSequence = " + charSequence.toString());
        return charSequence;
    }

    private void generateProxyClass(PrintWriter out) {
        addClassDefinition(out);
        addProxyBody(out);
        out.close();
    }

    private void addProxyBody(PrintWriter out) {
        addRealSubjectCreation(out, subject.getName(), realSubject.getName());
        addProxiedMethods(out);
        out.println("}");
    }

    protected abstract void addRealSubjectCreation(PrintWriter out, String name, String realName);


    private void addClassDefinition(PrintWriter out) {
        addImports(out);
        out.printf("public class %s %s %s {%n",
                proxy, getInheritanceType(subject), subject.getName());
    }

    private String getInheritanceType(Class subject) {
        return subject.isInterface() ? "implements" : "extends";
    }

    protected void addImports(PrintWriter out) {

    }

    private void addToStringIfInterface(PrintWriter out) {
        if (subject.isInterface()) {
            out.println();
            out.println(" public String toString() {");
            out.println(" if(realSubject() == null ) return \"NullObjectHolder in \" + this.getClass() ;");
            out.println(" return realSubject().toString();");
            out.println(" }");
        }
    }

    private void addProxiedMethods(PrintWriter out) {
        for (Method m : subject.getMethods()) {
            addProxiedMethod(out, m);
        }
        addToStringIfInterface(out);
    }

    private void addProxiedMethod(PrintWriter out, Method m) {
        if (Modifier.isFinal(m.getModifiers())) return;
        addMethodSignature(out, m);
        addMethodBody(out, m);   //NPE da val ger getter gefuellt wird

        final Class<?> returnType = m.getReturnType();
        if (returnType == void.class) out.printf(");%n }%n");
        else {
            out.printf(");%n");  //end of orig method.. start proxy additional stuff
            final boolean aFinal = Modifier.isFinal(returnType.getModifiers());
            if (!returnType.isPrimitive() && !returnType.isArray() && ! aFinal ){
                final String typeName = returnType.getTypeName();
                final String proxyGenerator = "org.rapidpm.module.se.commons.proxy.ProxyGenerator";
                final String concurrency = "org.rapidpm.module.se.commons.proxy.Concurrency";
                out.printf(" if (val == null) { System.out.println(\" val == null for method  + " +m.getName()+ "\");} %n");
                out.printf(typeName + " proxyObj = " + proxyGenerator+ ".make("+typeName+".class, "+typeName+".class, " +concurrency+"."+type.toString()+"); %n");

                if (type.equals(Concurrency.OnExistingObject)){
                    out.printf("try { %n");
                    out.printf("    proxyObj.getClass().getDeclaredField(\"realSubject\").set(proxyObj, val);  %n");
                    out.printf("} catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException e) {  %n");
                    out.printf("    e.printStackTrace(); %n");
                    out.printf("}  %n");
                }
                out.printf(" return proxyObj; %n");
            } else {
                out.printf(" return val; %n");
            }
                out.printf("%n}%n");
        }
    }

    private void addMethodSignature(PrintWriter out, Method m) {
        out.printf("%n public %s", Util.prettyPrint(m.getReturnType()));
        out.printf(" %s(", m.getName());
        addParameterList(out, m);
        out.printf(") {%n ");
    }

    private void addParameterList(PrintWriter out, Method m) {
        Class<?>[] types = m.getParameterTypes();
        for (int i = 0; i < types.length; i++) {
            String next = i == types.length - 1 ? "" : ", ";
            out.printf("%s p%d%s", Util.prettyPrint(types[i]), i, next);
        }
    }

    private void addMethodBody(PrintWriter out, Method m) {
        addMethodBodyDelegatingToRealSubject(out, m);
    }

    private void addMethodBodyDelegatingToRealSubject(PrintWriter out, Method m) {
        //hole result
        final Class<?> returnType = m.getReturnType();
        if (returnType == void.class) out.printf("realSubject().%s(", m.getName());
        else if(m.getName().equals("toString")){
            out.println("String val;");
            out.println(" if(realSubject() == null ) val = \"NullObjectHolder in \" + this.getClass() ; ");
            out.printf(" else val = realSubject().%s(", m.getName());
        } else if(m.getName().startsWith("get") && ! returnType.isPrimitive()){
            String name;
            if (returnType.isArray()) name = returnType.getSimpleName();
            else name = returnType.getName();
            out.println(name + " val;");
            out.println(" if(realSubject() == null ) val = null ; ");
            out.printf(" else val = realSubject().%s(", m.getName());   
        } else {
            String name;
            if (returnType.isArray()) name = returnType.getSimpleName();
            else name = returnType.getName();
            out.println(name + " val;");
            out.printf("val = realSubject().%s(", m.getName());  

        }
        addMethodCall(out, m);
    }

    private void addMethodCall(PrintWriter out, Method m) {
        Class<?>[] types = m.getParameterTypes();
        for (int i = 0; i < types.length; i++) {
            String next = i == types.length - 1 ? "" : ", ";
            out.printf("p%d%s", i, next);
        }
    }
}
    </class></pre>
The result is really cool. see the following code ;-)
<br/>
<pre class="brush: java">
       DemoClassA demoClassA = new DemoClassA();
        demoClassA.demoClassB = null;

        final String value = proxy(demoClassA).getDemoClassB().getDemoClassC().getValue();
        System.out.println("value = " + value);
    </class></pre>
<br/>

You can navigate the full path. no NPE! No boiler plate code!

<pre class="brush: java">
@Test
    public void testGenerator00X() throws  Exception {
        DemoClassA demoClassA = new DemoClassA();
        demoClassA.demoClassB = null;

        final String value = proxy(demoClassA).getDemoClassB().getDemoClassC().getValue();
        System.out.println("value = " + value);

    }

private DemoClassA proxy(DemoClassA demoClassA) {
        final Class&lt;DemoClassA&gt; aClass = (Class&lt;DemoClassA&gt;) demoClassA.getClass();
        final DemoClassA demo = ProxyGenerator.make(aClass, aClass, Concurrency.OnExistingObject);

        final Class&lt;? extends DemoClassA&gt; aClassProxy = demo.getClass();
        try {
            aClassProxy.getDeclaredField(&quot;realSubject&quot;).set(demo,demoClassA );
        } catch (IllegalArgumentException | IllegalAccessException | NoSuchFieldException | SecurityException e) {
            e.printStackTrace();
        }
        return demo;
    }
    </class></pre>
You can now use every getter.. not NPE. Only the result will be an null. This was exactly what I needed to get only the valid values from the model if they are available.
This means, that you could proxy an object after you have initialized it.
The full source code is available under : <a href="https://bitbucket.org/rapidpm/modules">https://bitbucket.org/rapidpm/modules</a> on the develop branch. I will merge it into the version 2.0 as generic pattern and CDI managed...




</div>            <!--
            <ul class="pager">
                <li><a href="#">Vorherige</a></li>
                <li><a href="#">Nächste</a></li>
            </ul>
            -->
        </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">

            <div class="sidebar-module sidebar-module-inset">
                <h4>About Us</h4>
                <p>We are a group of developers, speaking Java and proud to be nerds ;-)
                </p>
            </div>

            <div class="sidebar-module">
                <h4>YourKit</h4>
                    <ol class="list-unstyled">
                        <li><img src="http://www.yourkit.com/images/yklogo.png" alt="YourKit"></li>
                        <li>YourKit supports open source projects with its full-featured Java Profiler.
                            YourKit, LLC is the creator of <a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a>

                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Sponsoring</h4>
                    <ol class="list-unstyled">
                        <li><a href="http://www.codecentric.de">codecentric AG</a></li>
                        <li><a href="http://www.intellij.com">JetBrains</a></li>
                        <li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
                        <li><a href="https://www.atlassian.com/">Atlassian</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>We are at </h4>
                    <ol class="list-unstyled">
                        <li><a href="https://github.com/RapidPM">GitHub</a></li>
                        <li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
                        <li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
                        <li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
                        <li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Archives</h4>
                <ol class="list-unstyled">
<li><a href="/2014/12">2014-12</a></li>
<li><a href="/2014/11">2014-11</a></li>
<li><a href="/2014/10">2014-10</a></li>
<li><a href="/2014/06">2014-06</a></li>
<li><a href="/2014/05">2014-05</a></li>
<li><a href="/2014/04">2014-04</a></li>
<li><a href="/2014/03">2014-03</a></li>
<li><a href="/2014/02">2014-02</a></li>
<li><a href="/2014/01">2014-01</a></li>
<li><a href="/2013/12">2013-12</a></li>
<li><a href="/2013/11">2013-11</a></li>
<li><a href="/2013/10">2013-10</a></li>
<li><a href="/2013/09">2013-09</a></li>
<li><a href="/2013/08">2013-08</a></li>
<li><a href="/2013/07">2013-07</a></li>
<li><a href="/2013/06">2013-06</a></li>
<li><a href="/2013/05">2013-05</a></li>
                </ol>
            </div>

        </div><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</div><!-- /.container -->

<div class="blog-footer">
    <p>
        <a href="#">back to the top</a>
    </p>
</div>


<!-- Bootstrap-JavaScript
================================================== -->
<!-- Am Ende des Dokuments platziert, damit Seiten schneller laden -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://rapidpm.github.io/site/js/bootstrap.min.js"></script>
<script src="http://rapidpm.github.io/site/js/docs.min.js"></script>
<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
    SyntaxHighlighter.all()
</script>
</body>
</html>
