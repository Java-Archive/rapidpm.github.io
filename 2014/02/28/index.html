<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>RapidPM - Blog</title>

    <!-- Bootstrap-CSS -->
    <link href="http://rapidpm.github.io/site/css/bootstrap.min.css" rel="stylesheet">

    <!-- Besondere Stile für diese Vorlage -->
    <link href="http://rapidpm.github.io/site/css/blog.css" rel="stylesheet">

    <!-- Nur für Testzwecke. Kopiere diese Zeile nicht in echte Projekte! -->
    <!--[if lt IE 9]>
    <script src="http://rapidpm.github.io/site/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- Unterstützung für Media Queries und HTML5-Elemente im Internet Explorer über HTML5 shim und Respond.js -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!-- Include required JS files -->
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shCore.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJava.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushSql.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJScript.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushXml.js"></script>

    <!-- Include *at least* the core style and default theme -->
    <link href="http://rapidpm.github.io/site/syntax/shCore.css" rel="stylesheet" type="text/css" />
    <link href="http://rapidpm.github.io/site/syntax/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <!-- Custom styles for this template -->
    <link href="http://rapidpm.github.io/site/css/carousel.css" rel="stylesheet">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-35462441-1', 'auto');
    ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->
</head>

<body>

<!-- NAVBAR
================================================== -->
<div class="navbar-wrapper">
    <div class="container">

        <div class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://www.rapidpm.org">RapidPM</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/conferences/index.html">Conferences/Talks</a></li>
                        <li><a href="/publications/index.html">Publications</a></li>
                        <li><a href="/license/index.html">License</a></li>
                        <li><a href="/releases/index.html">Releases</a></li>
                        <li><a href="/contact/index.html">Contact</a></li>
                        <li><a href="/impressum/index.html">Impressum</a></li>
                        <!--
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Team<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Sven Ruppert</a></li>
                                <li><a href="#">Marco Ebbinghaus</a></li>
                                <li><a href="#">Alexander Bischof</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                        -->
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>






<div class="container">

    <div class="blog-header">
        <p>
            <h2 class="blog-title">The RapidPM Blog</h2>
        </p>
        <p class="lead blog-description">We are coding Java, because it is a great pleasure for us.</p>
    </div>

    <div class="row">

        <div class="col-sm-8 blog-main">
<div class="blog-post">
<h2 class="blog-post-title"><a href=/2014/02/28/wildfly-jboss--how-to-secure-customer-.html>Wildfly/JBoss: How to secure customer passwords</a></h2>
<p class="blog-post-meta">2014-02-28 from <a href="/team/alexander-bischof/">Alexander Bischof</a></p>
<div>
    If you are familiar with Wildfly/JBoss you might now that you can easily configure your system to use JAAS database authentication  for the login process of your customer. Because it is considered bad practice to store passwords in clear text a hash-algorithm (e.g. SHA256, MD5) can be specified to encrypt them. Further informations can be found under&nbsp;<a href="https://docs.jboss.org/author/display/WFLY8/Security+subsystem+configuration">here</a>.</div>
<div>
    <br /></div>
<div>
    The problem with that approach is that your passwords will be vulnerable to dictionary and rainbowtable attacks (refresh your knowlegde&nbsp;<a href="http://netsecurity.about.com/od/hackertools/a/Rainbow-Tables.htm">here</a>).</div>
<div>
    One way to face this problem is to use salted hashed passwords but the standard DatabaseServerLoginModule does not support that. But you can use <a href="http://www.rtner.de/software/PBKDF2.html">this</a>&nbsp;extension of the DatabaseServerLoginModule.</div>
<div>
    The configuration is fairly easy:</div>
<div>
    <br /></div>
<h3>
    Wildfly/JBoss Konfiguration</h3>
<div>
    <b>1</b>. Create module</div>
<div>
    Create the new module de.rtner.security.main and configure the module.xml like this</div>
<div>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.1" name="de.rtner.security"&gt;
    &lt;resources&gt;
        &lt;resource-root path="PBKDF2-1.0.4.jar"/&gt;
        &lt;resource-root path="SaltedDatabaseLoginModule-1.0.4.jar"/&gt;
    &lt;/resources&gt;
   &lt;dependencies&gt;
        &lt;module name="javax.api"/&gt;
        &lt;module name="javax.servlet.api"/&gt;
        &lt;module name="org.jboss.as.web-common"/&gt;
        &lt;module name="org.jboss.logging"/&gt;
        &lt;module name="org.picketbox"/&gt;
        &lt;module name="sun.jdk"/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</pre>
    Both declared jars must also be present in that folder.</div>
<div>
    <br /></div>
<div>
    <b>2</b>. Update module.xml of picketbox.</div>
<div>
    <br />
    Every custom login module has to be declared as a dependencies in the module.xml of picketbox. So just add this line:<br />
    <pre>&lt;module name="de.rtner.security"/&gt;</pre>
</div>
<div>
    <b>3</b>. Update standalone.xml</div>
<div>
<pre>&lt;login-module code="de.rtner.security.auth.spi.SaltedDatabaseServerLoginModule" flag="required" module="de.rtner.security"&gt;
 &lt;module-option name="dsJndiName" value="java:jboss/datasources/ExampleDS"/&gt;
 &lt;module-option name="principalsQuery" value="select password from User where login=?"/&gt;
 &lt;module-option name="rolesQuery" value="select role, 'Roles' from UserRole where login=?"/&gt;
 &lt;module-option name="hmacAlgorithm" value="HMacSHA256"/&gt;
 &lt;module-option name="formatter" value="de.rtner.security.auth.spi.PBKDF2HexFormatter"/&gt;
 &lt;module-option name="engine" value="de.rtner.security.auth.spi.PBKDF2Engine"/&gt;
 &lt;module-option name="engine-parameters" value="de.rtner.security.auth.spi.PBKDF2Parameters"/&gt;
&lt;/login-module&gt;</pre>
    <br /></div>
The password encryption can be done with the following function.
<br />
<div>
<pre class="brush: java">private String createPbKdF2Passwort(String password) throws NoSuchAlgorithmException
{
 PBKDF2Formatter formatter = new PBKDF2HexFormatter();
 SecureRandom sr = SecureRandom.getInstance("SHA1PRNG");
 byte[] salt = new byte[8];
 sr.nextBytes(salt);
 int iterations = 1000;
 PBKDF2Parameters p = new PBKDF2Parameters("HmacSHA256", "ISO-8859-1", salt, iterations);
 PBKDF2Engine e = new PBKDF2Engine(p);
 p.setDerivedKey(e.deriveKey(password));
 return formatter.toString(p);
}</pre>
    <br /></div>
<div>
    Have fun coding.</div>

</div>
            <!--
            <ul class="pager">
                <li><a href="#">Vorherige</a></li>
                <li><a href="#">Nächste</a></li>
            </ul>
            -->
        </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">

            <div class="sidebar-module sidebar-module-inset">
                <h4>About Us</h4>
                <p>We are a group of developers, speaking Java and proud to be nerds ;-)
                </p>
            </div>

            <div class="sidebar-module">
                <h4>YourKit</h4>
                    <ol class="list-unstyled">
                        <li><img src="http://www.yourkit.com/images/yklogo.png" alt="YourKit"></li>
                        <li>YourKit supports open source projects with its full-featured Java Profiler.
                            YourKit, LLC is the creator of <a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a>

                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Sponsoring</h4>
                    <ol class="list-unstyled">
                        <!--<li><a href="http://www.codecentric.de">codecentric AG</a></li>-->
                        <li><a href="http://www.intellij.com">JetBrains</a></li>
                        <li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
                        <li><a href="https://www.atlassian.com/">Atlassian</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>We are at </h4>
                    <ol class="list-unstyled">
                        <li><a href="https://github.com/RapidPM">GitHub</a></li>
                        <li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
                        <li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
                        <li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
                        <li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Archives</h4>
                <ol class="list-unstyled">
<li><a href="/2015/02">2015-02</a></li>
<li><a href="/2015/01">2015-01</a></li>
<li><a href="/2014/12">2014-12</a></li>
<li><a href="/2014/11">2014-11</a></li>
<li><a href="/2014/10">2014-10</a></li>
<li><a href="/2014/06">2014-06</a></li>
<li><a href="/2014/05">2014-05</a></li>
<li><a href="/2014/04">2014-04</a></li>
<li><a href="/2014/03">2014-03</a></li>
<li><a href="/2014/02">2014-02</a></li>
<li><a href="/2014/01">2014-01</a></li>
<li><a href="/2013/12">2013-12</a></li>
<li><a href="/2013/11">2013-11</a></li>
<li><a href="/2013/10">2013-10</a></li>
<li><a href="/2013/09">2013-09</a></li>
<li><a href="/2013/08">2013-08</a></li>
<li><a href="/2013/07">2013-07</a></li>
<li><a href="/2013/06">2013-06</a></li>
<li><a href="/2013/05">2013-05</a></li>
                </ol>
            </div>

        </div><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</div><!-- /.container -->

<div class="blog-footer">
    <p>
        <a href="#">back to the top</a>
    </p>
</div>


<!-- Bootstrap-JavaScript
================================================== -->
<!-- Am Ende des Dokuments platziert, damit Seiten schneller laden -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://rapidpm.github.io/site/js/bootstrap.min.js"></script>
<script src="http://rapidpm.github.io/site/js/docs.min.js"></script>
<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
    SyntaxHighlighter.all()
</script>
</body>
</html>
