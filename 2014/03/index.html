<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>RapidPM - Blog</title>

    <!-- Bootstrap-CSS -->
    <link href="http://rapidpm.github.io/site/css/bootstrap.min.css" rel="stylesheet">

    <!-- Besondere Stile für diese Vorlage -->
    <link href="http://rapidpm.github.io/site/css/blog.css" rel="stylesheet">

    <!-- Nur für Testzwecke. Kopiere diese Zeile nicht in echte Projekte! -->
    <!--[if lt IE 9]>
    <script src="http://rapidpm.github.io/site/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- Unterstützung für Media Queries und HTML5-Elemente im Internet Explorer über HTML5 shim und Respond.js -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!-- Include required JS files -->
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shCore.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJava.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJavaFX.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushSql.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushJScript.js"></script>
    <script type="text/javascript" src="http://rapidpm.github.io/site/syntax/shBrushXml.js"></script>

    <!-- Include *at least* the core style and default theme -->
    <link href="http://rapidpm.github.io/site/syntax/shCore.css" rel="stylesheet" type="text/css" />
    <link href="http://rapidpm.github.io/site/syntax/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <!-- Custom styles for this template -->
    <link href="http://rapidpm.github.io/site/css/carousel.css" rel="stylesheet">

    <!-- Google Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-35462441-1', 'auto');
    ga('send', 'pageview');

    </script>
    <!-- End Google Analytics -->
</head>

<body>

<!-- NAVBAR
================================================== -->
<div class="navbar-wrapper">
    <div class="container">

        <div class="navbar navbar-inverse navbar-static-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://www.rapidpm.org">RapidPM</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/conferences/index.html">Conferences/Talks</a></li>
                        <li><a href="/publications/index.html">Publications</a></li>
                        <li><a href="/license/index.html">License</a></li>
                        <li><a href="/releases/index.html">Releases</a></li>
                        <li><a href="/contact/index.html">Contact</a></li>
                        <li><a href="/impressum/index.html">Impressum</a></li>
                        <!--
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Team<b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Sven Ruppert</a></li>
                                <li><a href="#">Marco Ebbinghaus</a></li>
                                <li><a href="#">Alexander Bischof</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-header">Nav header</li>
                                <li><a href="#">Separated link</a></li>
                                <li><a href="#">One more separated link</a></li>
                            </ul>
                        </li>
                        -->
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>


<!-- Carousel
================================================== -->
<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
        <!--<li data-target="#myCarousel" data-slide-to="4"></li>
        <li data-target="#myCarousel" data-slide-to="5"></li>
        -->
    </ol>
    <div class="carousel-inner">
        <div class="item active">
            <!--<img data-src="holder.js/900x500/auto/#777:#7a7a7a/">-->
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>New Version 2.0.1</h1>
                    <p>the new version is available at maven central </br>
                    we added a new module for iot with tinkerforge.</p>
                    <p><a class="btn btn-lg btn-primary" href="http://search.maven.org/#search%7Cga%7C1%7Crapidpm"
                    role="button">jump to maven central</a></p>
                    <p><br/><br/><br/><br/></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
            <div class="container">
                <div class="carousel-caption">
                    <img src="/team/sven-ruppert/images/slider750x374.jpg ">
                    <p>@SvenRuppert (Core Java / CDI / JavaFX / Reflection)</p>
                </div>
            </div>
        </div>
        <div class="item">
                    <img data-src="holder.js/900x500/auto/#666:#6a6a6a/" >
                    <div class="container">
                        <div class="carousel-caption">
                            <img src="/team/alex-bischof/images/bildalexquer.JPG">
                            <p>@A_Bischof (Core Java / CDI / JavaEE )</p>
                        </div>
                    </div>
                </div>
        <div class="item">
            <img data-src="holder.js/auto/#666:#6a6a6a/text:" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>our git repository</h1>
                    <p>RapidPM could be found under <br/>
                    <code><a xlink:href="https://bitbucket.org/rapidpm/modules" target="_blank">bitbucket.org/rapidpm/modules</a></code>
                    </p>
                    <p><br/><br/><br/><br/></p>
                </div>
            </div>
        </div>
                <!--

        <div class="item">
            <img data-src="holder.js/900x500/auto/#666:#6a6a6a/text:Second slide" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>Another example headline.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img data-src="holder.js/900x500/auto/#555:#5a5a5a/text:Third slide" >
            <div class="container">
                <div class="carousel-caption">
                    <h1>One more for good measure.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
                </div>
            </div>
        </div>
        -->
    </div>
    <!--<a class="left carousel-control" href="#myCarousel" data-slide="prev"><span class="glyphicon glyphicon-chevron-left"></span></a>-->
    <!--<a class="right carousel-control" href="#myCarousel" data-slide="next"><span class="glyphicon glyphicon-chevron-right"></span></a>-->
</div><!-- /.carousel -->





<div class="container">

    <div class="blog-header">
        <h1 class="blog-title">The RapidPM Blog</h1>
        <p class="lead blog-description">We are speaking Java, because it is a great pleasure for us.</p>
    </div>

    <div class="row">

        <div class="col-sm-8 blog-main">
<div class="blog-post">
<h2 class="blog-post-title"><a href=/2014/03/10/lego-mindstorms-ev3-components--infrar.html>Lego Mindstorms EV3 Components: Infrared Sensor - Part 3</a></h2>
<p class="blog-post-meta">2014-03-10 from <a href="/team/sven-ruppert/">Sven Ruppert</a></p>
This is the last part of our articles on the mindstorm's infrared sensor. After looking at the abilities of the remote sensor to recognize objects and commands from the remote control we will now have a closer a look on the functionality of finding an infrared signal sent by the remote control constantly.<br />
<br />
In february the lejos api had a new release - 0.6.0-ALPHA, so while using the 0.5.0-ALPHA-release in our last articles we will by now use the 0.6.0-release.<br />
<br />
<h2>
    The robot</h2>
We will use the robot from the last two articles on the infrared sensor again, and of course we will use the remote control. If you haven't checked the infrared articles already ( <a href="http://www.rapidpm.org/2014/01/lego-mindstorms-ev3-components-infrared.html">Part 1</a>/<a href="http://www.rapidpm.org/2014/02/lego-mindstorms-ev3-components-infrared.html">Part 2</a>) you should do so.<br />
<br />
<h2>
    The parcours</h2>
There is the robot and there is the remote control. In this part we want to tell the robot: Hold a distance of about 20-35cm to the remote control!<br />
Which means that if we move the remote control nearer to the robot, it should move backwards and if we move the remote control away from the robot it should follow. We will only use the toggling button this time. If it is toggled and sending a signal, the robot should care about holding the right distance to the remote control. The program will exit if the signal ends (the button is untoggled).<br />
<br />
<h2>
    The infrared sensor API</h2>
As announced in our last part on the infrared sensor we will use the SeekMode this time to receive the relative position and distance of the remote control.<br />
<br />
What we will need to instantiate therefore is: the infrared sensor and a RangeFinderAdaptor for the infrared sensor.<br />
<br />
As soon as we instantiated a RangeFinderAdapter we can use its getRanges()-method which returns all required information to let the robot find the remote control and its position.<br />
<br />
We will use a thread which will check those informations continuously so that the robot will always react to changes of the remote controls position.<br />
<br />
Let us directly jump to the finished code and see how it works in detail.<br />
<br />
<h2>
    The code</h2>
We have two classes this time: The Main-class and the InfraredSignalCheckerThread-class. First, let's look at the main-class:<br />
<br />
<pre class="brush: java">public class Main {

    protected final static double PILOT_SPEED = 60.0;
    protected final static int PILOT_ACCELERATION = 500;
    protected final static double WHEEL_DIAMETER = 30.0f;
    protected final static double DISTANCE_BETWEEN_WHEELS = 170.0;

    public static void main(String[] args) throws InterruptedException {

        final DifferentialPilot pilot = new DifferentialPilot(WHEEL_DIAMETER, DISTANCE_BETWEEN_WHEELS, Motor.C, Motor.B);
        final EV3IRSensor infraredSensor = new EV3IRSensor(SensorPort.S2);
        final RangeFinderAdaptor rangeFinderAdaptor = new RangeFinderAdaptor(infraredSensor.getSeekMode());
        final InfraredSignalCheckerThread checkerThread = new InfraredSignalCheckerThread(rangeFinderAdaptor, pilot);

        configurePilot(pilot);
        checkerThread.start();

        Button.waitForAnyPress();
    }

    private static void configurePilot(final DifferentialPilot pilot) {
        pilot.setAcceleration(PILOT_ACCELERATION);
        pilot.setRotateSpeed(PILOT_SPEED);
        pilot.setTravelSpeed(PILOT_SPEED);
    }
}</pre>
<br />
First, we instantiate the pilot and the infraredSensor as always. Then we instantiate the RangeFinderAdapter which gets the infrared-sensor's SeekMode as a parameter. The RangeFinderAdapter will return all informations on the remote control's position. We then instantiate a InfraredSignalCheckerThread which gets the adaptor to check the remote control's position continuosly and the pilot to let the robot react on the remote control's position.<br />
<br />
After the instantiations we set the pilot's speeds and start the thread. So now let's have a look at our Thread-class:<br />
<br />
<pre class="brush: java">public class InfraredSignalCheckerThread extends Thread {

    private RangeFinderAdaptor adaptor;
    private DifferentialPilot pilot;
    private boolean isMoving = false;
    private  boolean isBearing = false;

    public InfraredSignalCheckerThread(final RangeFinderAdaptor adaptor, final DifferentialPilot pilot){
        this.adaptor = adaptor;
        this.pilot = pilot;
    }

    @Override
    public void run() {
        while(true){
            final float bearing = adaptor.getRanges()[0];
            final float distance = adaptor.getRanges()[1];
            if(distance &lt; 129.0f &amp;&amp; distance &gt; 127.0f &amp;&amp; bearing &lt; 1.0f){
                System.exit(0);
            }
            doBearing(bearing);
            doMoving(distance);
        }
    }

    private void doBearing(final float bearing) {
        if(bearingIsOk(bearing)){
            isBearing = false;
        }
        else {
            if(bearing &gt; 5.0f){
                pilot.rotateRight();
                isBearing = true;
            } else {
                pilot.rotateLeft();
                isBearing = true;
            }
        }
    }

    private void doMoving(final float distance) {
        if(!isBearing){
            if(!isMoving){
                pilot.quickStop();
            }
            if(distanceIsOk(distance)){
                pilot.quickStop();
                isMoving = false;
            }
            else {
                if(distance &lt; 25.0f){
                    pilot.backward();
                } else {
                    pilot.forward();
                }
                isMoving = true;
            }
        }
    }

    private boolean bearingIsOk(final float bearing) {
        if(bearing &lt; 5.0f &amp;&amp; bearing &gt; -5.0f){
            return true;
        }
        return false;
    }

    private boolean distanceIsOk(final float distance) {
        if(distance &gt;20.0f &amp;&amp; distance &lt; 35.0f){
            return true;
        }
        return false;
    }
}</pre>
<br />
The constructor is easy as it only saves the adaptor and the pilot into private variables so that we can use them in the run-method. If you have a look at the private variables you will see that there are two boolean attributes isBearing and isMoving. We need those variables because we want to robot to first react on direction changes of the remote control (which is done by rotating), and we don't want the robot to react on distance changes (which is done by moving forwards/backwards) until the bearing has finished.<br />
<br />
Okay, let's have a look at the run-method which is called when we start the thread in the main-class.<br />
We need two information on our remote control: The relative bearing to the robot and the distance to the robot. As said earlier, the getRanges()-Method returns those information. Here is what the api says:<br />
<pre class="brush: java">/**
     * return a sample provider for the IR sensor operating in seek mode
     * The provider returns the bearing and distance to one or more IR beacons.
     * Up to four
     * beacons (on different channels 0-3) can be detected. Each beacon has an
     * associated two byte value (so the beacon on channel 0 will have values
     * in locations 0 and 1 in the array. The first location contains the relative
     * bearing to the beacon, the second the distance.

     * The bearing values range from -12 to +12 (with values increasing clockwise
     * when looking from behind the sensor. A bearing of 0 indicates the beacon is
     * directly in front of the sensor. Distance values (0-100) are in cm and if no
     * beacon is detected a bearing of 0 and a distance of 255 is returned.</pre>
<br />
So, we only care for the first two floats of the array because we only have one remote control. And we want the bearing-information of it ([0]) and the distance-information ([1]).<br />
<br />
After writing those informations into float variables we check, if the information are valid: The api says, if no signal is found the value of bearing will be 0 and the distance will be 255. So first, we check this case and exit the program if no signal is found (I found out, that if no signal is sent, the distance value is 128.0 and not 255 as written in the api).<br />
<br />
If the values are valid (a signal was received we call the methods doBearing and doMoving). Those methods will make the robot first react on direction changes of the remote control, and then react on distance changes afterwards. Let's have a closer look at these two methods, first the doBearing-Method:<br />
<br />
<pre class="brush: java">private void doBearing(final float bearing) {
        if(bearingIsOk(bearing)){
            isBearing = false;
        }
        else {
            if(bearing &gt; 5.0f){
                pilot.rotateRight();
                isBearing = true;
            } else {
                pilot.rotateLeft();
                isBearing = true;
            }
        }
    }

</pre>
<pre class="brush: java">private boolean bearingIsOk(final float bearing) {
        if(bearing &lt; 5.0f &amp;&amp; bearing &gt; -5.0f){
            return true;
        }
        return false;
    }
</pre>
<br />
First, we check if the bearing is okay, which means that the remote control is more or less directly in front of the robot. As said in the api that value can be anything between -12 and 12 (I found out, that this value can be anything between -25 and 25). So we tell the program, if the value is between -5 and 5 the bearing is okay and the reaction of the robot has finished. If the bearing is not okay, we tell the robot to rotate right of the bearing is greater than 5, or rotate left if the value is lower than -5. While rotating, we tell the program, that the robot is reacting to the bearing, by setting the isBearing-attribute to true. By the rotation the bearing value will approach to 0. When that's the case we tell the program, that the robot has finished its reaction and set the isBearing variable to false.<br />
<br />
And here's the doMoving-Method:<br />
<br />
<div>
<pre class="brush: java">private void doMoving(final float distance) {
        if(!isBearing){
            if(!isMoving){
                pilot.quickStop();
            }
            if(distanceIsOk(distance)){
                pilot.quickStop();
                isMoving = false;
            }
            else {
                if(distance &lt; 20.0f){
                    pilot.backward();
                } else {
                    pilot.forward();
                }
                isMoving = true;
            }
        }
    }
</pre>
<pre class="brush: java">private boolean distanceIsOk(final float distance) {
        if(distance &gt;20.0f &amp;&amp; distance &lt; 35.0f){
            return true;
        }
        return false;
    }
</pre>
    <br />
    When the doBearing-method has finished, the doMoving-method will start. But we only want to react on the remote control's distance if the robot has finished it's reaction to the bearing. So we first check, if the robot is not bearing any longer. The second "if" that follows now is a bit tricky: We check, if the robot is moving as a result from the doMoving-Method or as a result from the doBearing-method. If it NOT moving as a result of the doMoving-method, it should stop because then we have the case, that the robot is still rotating as a reacting to the bearing (we didn't tell the program to stop rotating any time in the doBearing-method). So after that, we check if the remote control's distance is okay (which means the remote control is in a distance of 20 to 35cm) to the robot. If that is the case the robot should stop and we mark the isMoving-attribute as false. If the distance is NOT okay we tell the robot to move backwards of the distance is less then 25 (because it should "flee" from the remote control) or move forwards if the distance is greater than 35 (because it should "follow" the remote control).<br />
    <br /></div>
<h2>
    The result</h2>
And here is the result (watch on youtube for better quality):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <br /></div>
<div class="separator" style="clear: both; text-align: center;">
    <object width="320" height="266" class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://i1.ytimg.com/vi/hGBv4OA2b9Q/0.jpg"><param name="movie" value="https://www.youtube.com/v/hGBv4OA2b9Q?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/hGBv4OA2b9Q?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></div>
<br />
<br />
<br />
</div>
<div class="blog-post">
<h2 class="blog-post-title"><a href=/2014/03/17/lego-mindstorms-ev3-components--color-.html>Lego Mindstorms EV3 Components: Color Sensor - Part 1</a></h2>
<p class="blog-post-meta">2014-03-17 from <a href="/team/sven-ruppert/">Sven Ruppert</a></p>
In this and in our next postings on our Lego Mindstorms series we will have a closer look at the EV3 color sensor. Today we will use the sensor's ability of detecting and distinguishing different colors.<br />
<br />
Meanwhile version 0.7.0 of the lejos api was released. But in this tutorial we will still use the 0.6.0-release as 0.7.0s changes weren't dramatic. So you should be able to run the same program with 0.7.0, too.<br />
<br />
<h2>
    The robot</h2>
The only task the robot will do in this tutorial is: Detecting colors and tell us which color was detected. So in fact we only need the sensor. No motors or something like that is needed. But as we already have a robot from our last articles on the infrared sensor we will take that one and only switch the infrared sensor with the new color sensor.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://1.bp.blogspot.com/-4ymIE9suwYE/UyW4_gA8p9I/AAAAAAAAAMM/ei3h5K1LB6w/s1600/DSCN0665.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-4ymIE9suwYE/UyW4_gA8p9I/AAAAAAAAAMM/ei3h5K1LB6w/s1600/DSCN0665.JPG" height="320" width="240" /></a></div>
<br />
<br />
<h2>
    The parcours</h2>
We built a stick with different colors: red, green, yellow and blue. We will hold the different colors in front of the robot's sensor and the robot should give feedback on the detected color by letting the background-LED of the brick's buttons illuminate in the same color. One exception: If blue is detected the program should exit.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="http://4.bp.blogspot.com/-r5IwUOLzJ0Q/UyW8RDwVa_I/AAAAAAAAAMY/mODactZInrw/s1600/DSCN0667.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-r5IwUOLzJ0Q/UyW8RDwVa_I/AAAAAAAAAMY/mODactZInrw/s1600/DSCN0667.JPG" height="96" width="320" /></a></div>
<br />
<h2>
    The color sensor API</h2>
Like the infrared sensor the color sensor has different modes for different tasks. The infrared sensor for example had modes to detect signals of an infrared source or to detect objects and their distance to the robot.<br />
There is a mode for every task a sensor can execute. To detect different colors we need the color sensor's colorIDMode. Once the sensor is in the right mode we only need to call&nbsp;colorSensor.getColorID to get the detected color.<br />
<br />
Sounds easy, IS easy. Here comes the code.<br />
<br />
<h2>
    The code</h2>
We have two classes this time: The Main-class and the ColorRecognizerThread-class. First, let's look at the (really small) main-class:<br />
<br />
<pre class="brush: java">public class Main {


    public static void main(String[] args) throws InterruptedException {
        final EV3ColorSensor colorSensor = new EV3ColorSensor(SensorPort.S2);
        final SensorMode mode = colorSensor.getColorIDMode();
        final ColorRecognizerThread colorRecognizerThread = new ColorRecognizerThread(colorSensor);

        colorRecognizerThread.start();

        Button.waitForAnyPress();
    }

}</pre>
<br />
In contrast to our earlier postings we don't need a DifferentialPilot this time because the robot doesn't have to move. So the only things we do is instantiating a new ColorSensor-Instance and set it to the colorIDMode. Then we instantiate a ColorRecognizerThread (which extends Thread) and give it the color sensor object as a constructor parameter. In that thread we will implement the logic to detect colors and let the LED illuminate in the same color.<br />
After starting the thread we wait for any button press as always so that our program won't just exit after starting the thread.<br />
<br />
The ColorRecognizerThread looks like the following:<br />
<br />
<pre class="brush: java">public class ColorRecognizerThread extends Thread {

    private EV3ColorSensor colorSensor;

    public ColorRecognizerThread(final EV3ColorSensor colorSensor) {
        this.colorSensor = colorSensor;
    }

    @Override
    public void run() {
        while(true){
            final int colorId = colorSensor.getColorID();
            switch (colorId){
                //RED
                case 0:
                    Button.LEDPattern(2);
                    break;
                //GREEN
                case 1:
                    Button.LEDPattern(1);
                    break;
                //BLUE
                case 2:
                    Button.LEDPattern(4);
                    threadSleep(2000);
                    Button.LEDPattern(0);
                    System.exit(0);
                //YELLOW
                case 3:
                    Button.LEDPattern(3);
                    break;
                default:
                    Button.LEDPattern(0);
            }
        }
    }

    private void threadSleep(final int ms) {
        try {
            Thread.sleep(ms);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

}</pre>
<br />
The constructor is easy as it only saves the color sensor object into a private variable so that we can use it in the run-method.<br />
The really interesting part is the run-method of course, which is called when starting the thread in the main class. We have a deadloop as we want the robot to detect colors continuously. In that loop we get the color found by the color sensor by calling the getColorID()-Method. As you can see it returns an integer. By having a look at the sources (Color.java) we find out which integer value stands for which color:<br />
<br />
<pre class="brush: java">    public static final int RED = 0;
    public static final int GREEN = 1;
    public static final int BLUE = 2;
    public static final int YELLOW = 3;
    public static final int MAGENTA = 4;
    public static final int ORANGE = 5;
    public static final int WHITE = 6;
    public static final int BLACK = 7;
    public static final int PINK = 8;
    public static final int GRAY = 9;
    public static final int LIGHT_GRAY = 10;
    public static final int DARK_GRAY = 11;
    public static final int CYAN = 12;
    public static final int BROWN = 13;
    public static final int NONE = -1;</pre>
<br />
So, after getting the id we have a "switch case"-statement for that id. If the found color is red, green or yellow we just want the background-LED of the brick to illuminate in the same color (case 0, 1 and 3). Maybe you are curious why the integer parameter for the Button.LEDPattern-method doesn't match with the integer values from the Color-class. Well, the LED doesn't have a pattern for all of the colors. It has 9 different patterns in total (thanks to <a href="http://www.lejos.org/forum/viewtopic.php?p=22564#p22564" target="_blank">tigger from the forum</a> for that information!)<br />
<br />
<blockquote class="tr_bq">
    0: turn off button lights<br />
    1/2/3: static light green/red/yellow<br />
    4/5/6: normal blinking light green/red/yellow<br />
    7/8/9: fast blinking light green/red/yellow<br />
    &gt;9: same as 9.</blockquote>
&nbsp;If the color blue is found (case 2) I wanted the program to do the following: Turn the light of the color sensor of and exit the program. The api says that we can use the setFloodlight(int color)-method for that by calling it with Color.NONE:<br />
<br />
<pre class="brush: java">/**
* Used to turn on or off the floodlight by color. If the sensor has multiple light colors,
* you can control which color is turned on or off. If the color does not exist, it does
* nothing and returns false. You can turn the floodlight off by using Color.NONE.</pre>
But this throws an exception if you look at the sources of EV3ColorSensor (the default case of the switch-statement):<br />
<br />
<pre class="brush: java">public boolean setFloodlight(int color)
    {
        int mode;
        switch (color)
        {
        case Color.BLUE:
            mode = COL_AMBIENT;
            break;
        case Color.WHITE:
            mode = COL_COLOR;
            break;
        case Color.RED:
            mode = COL_REFLECT;
            break;
        default:
            // TODO: Should we ignore a wrong color or throw an exception?
            throw new IllegalArgumentException("Invalid color specified");
        }
        switchMode(mode, SWITCH_DELAY);
        // TODO Auto-generated method stub
        return true;
    }</pre>
<br />
But I never the less wanted to give some optic signal to show that the program is exiting. Turning off the LED wasn't enough because we already turn it of in our default case of our switch statement in the ColorRecognizerThread. In the end I decided to let the LED display the pattern 4 (blinking green) for two seconds before exiting the program. The threadSleep-method was just created to have the try-catch out of our run-method (because it looks stupid).<br />
<br />
That's all.<br />
<br />
<h2>
    The result</h2>
And here is the tiny result (watch on youtube for better quality):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
    <br /></div>
<center>
    <object class="BLOGGER-youtube-video" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" data-thumbnail-src="https://i1.ytimg.com/vi/mhQgVQueluk/0.jpg" height="266" width="320"><param name="movie" value="https://www.youtube.com/v/mhQgVQueluk?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" /><param name="bgcolor" value="#FFFFFF" /><param name="allowFullScreen" value="true" /><embed width="320" height="266"  src="https://www.youtube.com/v/mhQgVQueluk?version=3&f=user_uploads&c=google-webdrive-0&app=youtube_gdata" type="application/x-shockwave-flash" allowfullscreen="true"></embed></object></center>
<br />
<div class="separator" style="clear: both; text-align: center;">
</div>
<br />
<br />
</div>
<div class="blog-post">
<h2 class="blog-post-title"><a href=/2014/03/28/java8-completablefuture-for-javafx-and.html>Java8 CompletableFuture for JavaFX and CDI Part I</a></h2>
<p class="blog-post-meta">2014-03-28 from <a href="/team/sven-ruppert/">Sven Ruppert</a></p>
Java8 CompletableFuture for JavaFX and CDI Part I

Java8 will give you a few more tools to solve concurrency problems.<br/>
One of them is the CompletableFuture. I will show you, how you could sync the <br/>
two different init-cycles from CDI and JavaFX with this.<br/>
<br/>
CDI and JavaFX are using a life-cycle during the init process. <br/>
For CDI you can use the method that is annotated with the <br/>
AnnotationLiteral @Postconstruct and for JavaFX you can use the method initialize(..)
<br/>
If you want to have a method that is called after both others are finished you have to think <br/>
about the problem that it is not clear which method is called first.<br/>
To show more in detail what the problem is let us think about the following.
<br />
<pre class="brush: java"> 
private String pattern;
private SimpleDateFormat sdf;

//beispielhaft für eine init
public void createSDF(){
    this.sdf = new SimpleDateFormat(this.pattern);        
}

//beispielhaft für eine init
public void newPattern(final String pattern) {
    this.pattern = pattern;
}

public String format(final Date date){
    return sdf.fomat(date);
}
</pre>

To use the method format(..) you must use the methods newPattern(..) and createSDF first.<br/>
But both in the right order like the following code snipp.
<br />
<pre class="brush: java"> 
newPattern("yyyy.MM.dd");
createSDF();
final String s = versionAB.format(new Date());
System.out.println("s = " + s);
</pre>
If you are calling first createSDF(..) for example you will get an exception.<br/>
But thinking to the problem with CDI and JavaFX it must be
valid to do something like the following.
<br />
<pre class="brush: java"> 
createSDF();
newPattern("yyyy.MM.dd");

final String s = versionAB.format(new Date());
System.out.println("s = " + s);
</pre>
The method creatdSDF(..) is called before newPattern(..).<br/>
The solution is quite simple. The method call from createSDF must be non blocking but<br/>
waiting with the execution until newPattern(..) was called.<br/>
The same with format(..). This method call must wait until both are finished but itself it <br/>
is an blocking method call. This is to give the developer the feeling he expected, <br/>
if he is working with the result from format(..).
<br/>
To solve this we have to booleans called initCompleteA and initCompleteB. <br/>
Both are false in the beginning. If newPattern(..) is called initcompleteA will be true, <br/>
and initCompleteB will be true after the method creatSDF() is ready.

<br />
<pre class="brush: java"> 
public void newPattern(final String pattern) {
    this.pattern = pattern;
    initCompleteA=true;
    System.out.println("newPattern = " + pattern);
}
public void createSDF(){
    CompletableFuture&lt;Void&gt; supplyAsync
        = CompletableFuture
        .supplyAsync(taskCreateSDF, cachedThreadPool);
    supplyAsync.thenAccept(System.out::println);
}
public Supplier&lt;Void&gt; taskCreateSDF = ()-&gt; {
    while(! initCompleteA ){
        try {
            System.out.println("createSDF is waiting" );
            TimeUnit.MILLISECONDS.sleep(4);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    sdf = new SimpleDateFormat(pattern);
    initCompleteB = true;
    return null;
};
</pre>

The Method format(..) now is only waiting for both...
<br />
<pre class="brush: java"> 
public Supplier&lt;String&gt; task = ()-&gt; {
//Warten bis alle true
    while(! (initCompleteA && initCompleteB) ){
        try {
            System.out.println("initCompleteA = " + initCompleteA);
            System.out.println("initCompleteB = " + initCompleteB);
            System.out.println("pattern = " + pattern);
            System.out.println("sdf = " + sdf);
            TimeUnit.MILLISECONDS.sleep(1);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
    return sdf.format(this.date);
};
private Date date;

public String format(final Date date){
    this.date = date;
    supplyAsync = CompletableFuture
        .supplyAsync(task, cachedThreadPool);
    try {
        return supplyAsync.get();
    } catch (InterruptedException | ExecutionException e) {
        e.printStackTrace();
    }
    return "";
}
</pre>

The example you will find at
<a href="http://stash.rapidpm.org/projects/PUB/repos/jaxenter.de-0016-async-calls/browse">http://stash.rapidpm.org/projects/PUB/repos/jaxenter.de-0016-async-calls/browse</a>
<br/>
The next Part will show how we have to implement
the JavaFX CDI bootstrapping to use this.

</div>
            <!--
            <ul class="pager">
                <li><a href="#">Vorherige</a></li>
                <li><a href="#">Nächste</a></li>
            </ul>
            -->
        </div><!-- /.blog-main -->

        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">

            <div class="sidebar-module sidebar-module-inset">
                <h4>About Us</h4>
                <p>We are a group of developers, speaking Java and proud to be nerds ;-)
                </p>
            </div>

            <div class="sidebar-module">
                <h4>YourKit</h4>
                    <ol class="list-unstyled">
                        <li><img src="http://www.yourkit.com/images/yklogo.png" alt="YourKit"></li>
                        <li>YourKit supports open source projects with its full-featured Java Profiler.
                            YourKit, LLC is the creator of <a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a>

                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Sponsoring</h4>
                    <ol class="list-unstyled">
                        <li><a href="http://www.codecentric.de">codecentric AG</a></li>
                        <li><a href="http://www.intellij.com">JetBrains</a></li>
                        <li><a href="http://zeroturnaround.com/">zeroturnaround</a></li>
                        <li><a href="https://www.atlassian.com/">Atlassian</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>We are at </h4>
                    <ol class="list-unstyled">
                        <li><a href="https://github.com/RapidPM">GitHub</a></li>
                        <li><a href="https://twitter.com/SvenRuppert">Twitter - Sven Ruppert</a></li>
                        <li><a href="https://plus.google.com/u/0/+SvenRuppert/">GooglePlus - Sven Ruppert</a></li>
                        <li><a href="https://twitter.com/A_Bischof">Twitter - Alexander Bischof</a></li>
                        <li><a href="https://plus.google.com/u/0/100135686516251171415/">GooglePlus - Alexander Bischof</a></li>
                    </ol>
            </div>
            <div class="sidebar-module">
                <h4>Archives</h4>
                <ol class="list-unstyled">
<li><a href="/2015/01">2015-01</a></li>
<li><a href="/2014/12">2014-12</a></li>
<li><a href="/2014/11">2014-11</a></li>
<li><a href="/2014/10">2014-10</a></li>
<li><a href="/2014/06">2014-06</a></li>
<li><a href="/2014/05">2014-05</a></li>
<li><a href="/2014/04">2014-04</a></li>
<li><a href="/2014/03">2014-03</a></li>
<li><a href="/2014/02">2014-02</a></li>
<li><a href="/2014/01">2014-01</a></li>
<li><a href="/2013/12">2013-12</a></li>
<li><a href="/2013/11">2013-11</a></li>
<li><a href="/2013/10">2013-10</a></li>
<li><a href="/2013/09">2013-09</a></li>
<li><a href="/2013/08">2013-08</a></li>
<li><a href="/2013/07">2013-07</a></li>
<li><a href="/2013/06">2013-06</a></li>
<li><a href="/2013/05">2013-05</a></li>
                </ol>
            </div>

        </div><!-- /.blog-sidebar -->

    </div><!-- /.row -->

</div><!-- /.container -->

<div class="blog-footer">
    <p>
        <a href="#">back to the top</a>
    </p>
</div>


<!-- Bootstrap-JavaScript
================================================== -->
<!-- Am Ende des Dokuments platziert, damit Seiten schneller laden -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://rapidpm.github.io/site/js/bootstrap.min.js"></script>
<script src="http://rapidpm.github.io/site/js/docs.min.js"></script>
<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
    SyntaxHighlighter.all()
</script>
</body>
</html>
